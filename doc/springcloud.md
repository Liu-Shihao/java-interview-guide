## Spring Cloud 分布式微服务
**Spring Cloud 提供了微服务架构的完整解决方案**
### SpringCloud组件
1. 服务注册与发现：维护服务实例的动态列表。通过心跳机制监控实例状态，自动移除不可用实例。
   - Eureka：服务注册中心，支持服务实例的动态注册于发现。
   - Nacos：集服务注册、配置中心于一体，支持动态服务列表和健康检查。提供了有好的管理页面

服务调用不直接通过注册中心，但依赖注册中心提供的服务发现功能。
  - 服务注册：服务提供者启动时，将自身信息（IP、端口）注册到注册中心。
  - 服务发现：服务消费者通过注册中心查询目标服务的实例列表。
  - 实际调用：消费者根据获取的地址直接向服务提供者发起请求（如HTTP/RPC），​​不经过注册中心​

客户端可以通过注册中心发现服务实例。

2. 负载均衡：从注册中心获取**实例服务列表**，按照策略分发请求。
   - Ribbon：客户端负载均衡器，支持多种负载均衡策略：轮询、随机、加权轮询等。与Eureka/Nacos集成。
   - SpringCloud LoadBalancer：新一代负载均衡器，替代Ribbon。

负载均衡器从注册中心拉取目标服务的所有可用实例。根据策略（轮询、随机、权重）选择实例分发请求，不经过注册中心。


3. 服务通信：客户端与服务端之间的通信。
   - Feign/OpenFeign：声明式的HTTP客户端，基于接口注解简化HTTP调用，集成Ribbon。
   - Dubbo(Alibaba)：PRC远程调用框架，支持高性能远程调用。

4. 服务熔断：当服务调用失败或响应时间过长时，自动切换到备用服务。
   - Hystrix(Netflix )：熔断器，已停更。支持服务降级、熔断、限流等功能。
   - Sentinel(Alibaba)：流量控制、熔断降级，提供实时监控和规则配置。

5. API 网关：统一入口，处理鉴权、日志、请求路由转发功能。
   - Zuul(Netflix)：第一代API网关，已逐渐被淘汰。支持路由、过滤、鉴权等功能。
   - SpringCloud Gateway：新一代API网关，支持动态路由、限流、鉴权等功能。基于异步非阻塞模型。

6. 配置中心：避免配置文件分散在各个服务中，统一管理。
   - SpringCloud Config：集中化管理，支持Git/本地存储，需要配合Bus实现动态刷新。
   - Nacos Config：内置配置管理，支持多环境配置和实时推送。

7. 消息总线与事件驱动：
   - SpringCloud Bus：消息总线，配置变更后需手动刷新（配合 Spring Cloud Bus 可实现自动刷新）。
   - SpringCloud Stream：事件驱动，支持消息发布和订阅，通过消息中间件（如 Kafka、RabbitMQ）实现微服务间异步通信。

8. 分布式链路追踪
   - Sleuth：生成请求链路ID（Trace/Span）,集成Zipkin展示调用链。
   - Zipkin：分布式链路追踪系统，收集和可视化追踪数据，支持微服务之间的调用链追踪。

9. 分布式事务
   - TCC：Try-Confirm-Cancel，支持分布式事务的补偿机制。
   - Seata：提供AT、TCC等模式，解决跨服务数据一致性问题

### PRC与HTTP的区别？
PRC（Remote Procedure Call）远程过程调用，允许程序想调用本地方法一样调用远程服务，隐藏底层网络通信细节。开发者无需关心网络传输、序列化等底层实现，只需关注业务逻辑。

典型场景：微服务内部通信，高性能分布式系统（gRPC、Dubbo）

HTTP（Hypertext Transfer Protocol）超文本传输协议，应用层协议，用于用于客户端与服务器之间的资源传输。基于请求-响应模型，通过URL访问资源。

RPC的性能更高，使用二进制序列化，减少传输开销。而HTTP性能较低，使用文本格式（如json），解析效率低；
PRC的开发复杂度较高，需要处理序列化；HTTP开发复杂度低，基于标准协议，工具链成熟。


## 微服务间调用

1. 直接使用RestTemplate调用，需要手动拼接URL，适合简单场景。
2. OpenFeign声明式HTTP客户端，基于接口注解简化HTTP调用，默认集成Ribbon实现负载均衡。
3. gRPC远程过程调用框架，支持高性能远程调用，基于HTTP/2和Protobuf序列化。

## 如何设计高并发系统？



## 限流算法

1. 计数器算法- 固定窗口
最简单的限流算法，在固定时间窗口内计数，超过阈值则限流

2. 滑动窗口
将固定窗口划分多个小窗口，每个窗口独立计数。

3. 漏桶算法
请求以任意速率流入漏桶，以固定速率流出。当漏桶满时，多余请求直接拒绝。

4. 令牌桶算法
以恒定速率生成令牌放入桶中，请求需要先获取令牌才能通过。

## 如何设计一个秒杀系统？
1. 数据库设计
   - 秒杀商品表：记录商品库存、秒杀开始/结束时间
   - 秒杀订单表：记录用户秒杀成功订单
2. 业务逻辑
   - 秒杀前：校验用户合法性、商品库存
   - 秒杀中：
2. 
